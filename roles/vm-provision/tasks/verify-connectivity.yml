---
# =============================================================================
# Verify VM connectivity
# =============================================================================

- name: Test SSH to all VMs
  command: >
    ssh -i {{ ssh_key_path }}
    -o StrictHostKeyChecking=no
    -o ConnectTimeout=10
    {{ vm_user }}@{{ item.ip }} echo "SSH OK"
  loop: "{{ vms }}"
  loop_control:
    label: "{{ item.name }}"
  register: ssh_test
  changed_when: false
  become: no

- name: Display SSH test results
  debug:
    msg: "{{ item.item.name }}: {{ item.stdout }}"
  loop: "{{ ssh_test.results }}"
  loop_control:
    label: "{{ item.item.name }}"
